/**
 * ============================================================================
 * Smart Mall 应用入口文件 (main.ts)
 * ============================================================================
 * 
 * 【文件职责】
 * 这是整个 Vue 应用的启动入口，负责：
 * 1. 创建 Vue 应用实例
 * 2. 注册全局插件（Pinia、Element Plus、Router）
 * 3. 挂载应用到 DOM
 * 
 * 【启动流程】
 * 1. 创建 Vue 应用实例 (createApp)
 * 2. 创建 Pinia 状态管理实例 (createPinia)
 * 3. 按顺序注册插件：Pinia → Element Plus → Router
 * 4. 挂载到 #app 元素
 * 
 * 【插件注册顺序说明】
 * Pinia 必须在 Router 之前注册，因为：
 * - 路由守卫 (guards.ts) 中需要访问 userStore 检查登录状态
 * - 如果 Router 先注册，守卫执行时 Pinia 还未初始化，会报错
 * 
 * 【技术栈】
 * - Vue 3: 渐进式 JavaScript 框架
 * - Pinia: Vue 官方推荐的状态管理库（替代 Vuex）
 * - Element Plus: 基于 Vue 3 的 UI 组件库
 * - Vue Router: Vue 官方路由管理器
 * - SCSS: CSS 预处理器，支持嵌套、变量、混入等特性
 * 
 * ============================================================================
 */

// ============================================================================
// Vue 核心
// ============================================================================

import { createApp } from 'vue'

// ============================================================================
// 状态管理 - Pinia
// ============================================================================

/**
 * Pinia 是 Vue 3 官方推荐的状态管理库
 * 
 * 【为什么用 Pinia 而不是 Vuex？】
 * 1. 更简洁的 API，不需要 mutations
 * 2. 完整的 TypeScript 支持
 * 3. 更好的代码分割和模块化
 * 4. 支持 Composition API 风格
 * 5. 开发工具支持更好
 */
import { createPinia } from 'pinia'

// ============================================================================
// UI 框架 - Element Plus
// ============================================================================

/**
 * Element Plus 是基于 Vue 3 的 UI 组件库
 * 
 * 【导入说明】
 * - ElementPlus: 完整组件库（全量导入，方便开发）
 * - index.css: 组件基础样式
 * - dark/css-vars.css: 暗色主题 CSS 变量
 * 
 * 【生产优化】
 * 如果需要减小打包体积，可以改为按需导入：
 * import { ElButton, ElCard } from 'element-plus'
 */
import ElementPlus from 'element-plus'
import 'element-plus/dist/index.css'
import 'element-plus/theme-chalk/dark/css-vars.css'

// ============================================================================
// 应用组件和路由
// ============================================================================

/**
 * SmartMall.vue 是应用的根组件
 * 包含 ElConfigProvider（国际化配置）和 router-view（路由出口）
 */
import SmartMall from './SmartMall.vue'

/**
 * 路由配置
 * 包含所有页面路由定义和路由守卫
 */
import router from './router'

// ============================================================================
// 全局样式
// ============================================================================

/**
 * SCSS 设计系统
 * 
 * 【包含内容】
 * - _variables.scss: 设计令牌（颜色、间距、字体、阴影）
 * - _mixins.scss: 可复用混入（响应式、Flexbox、Grid）
 * - _animations.scss: 关键帧动画
 * - _utilities.scss: 工具类
 * - _components.scss: 组件样式
 * - _base.scss: 基础重置样式
 * - main.scss: 主入口，包含 Element Plus 覆盖样式
 */
import './assets/styles/scss/main.scss'

// ============================================================================
// 应用初始化
// ============================================================================

/**
 * 创建 Vue 应用实例
 * SmartMall 是根组件，所有其他组件都是它的子组件
 */
const app = createApp(SmartMall)

/**
 * 创建 Pinia 实例
 * 用于管理全局状态（用户信息、商城数据、系统配置等）
 */
const pinia = createPinia()

// ============================================================================
// 插件注册（顺序很重要！）
// ============================================================================

/**
 * 1. 注册 Pinia（状态管理）
 * 必须最先注册，因为后续的路由守卫需要访问 store
 */
app.use(pinia)

/**
 * 2. 注册 Element Plus（UI 组件库）
 * 全局注册后，所有组件都可以直接使用 El* 组件
 */
app.use(ElementPlus)

/**
 * 3. 注册 Router（路由管理）
 * 最后注册，因为路由守卫中会用到 Pinia store
 * 
 * 【路由守卫执行时机】
 * - 在 app.use(router) 时，会立即执行 beforeEach 守卫
 * - 如果此时 Pinia 未注册，访问 store 会报错
 */
app.use(router)

// ============================================================================
// 挂载应用
// ============================================================================

/**
 * 将 Vue 应用挂载到 DOM
 * 
 * #app 元素定义在 index.html 中：
 * <div id="app"></div>
 * 
 * 挂载后，Vue 会接管这个元素，渲染 SmartMall 组件
 */
app.mount('#app')
