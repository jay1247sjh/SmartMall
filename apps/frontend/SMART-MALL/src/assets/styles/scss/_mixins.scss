/**
 * Smart Mall 设计系统 - SCSS Mixins
 * 可复用的样式混入
 */

@use 'variables' as *;

// ============================================================================
// 响应式断点
// ============================================================================

/// 最小宽度媒体查询
/// @param {String} $breakpoint - 断点名称 (sm, md, lg, xl, 2xl)
@mixin breakpoint-up($breakpoint) {
  $value: map-get($breakpoints, $breakpoint);
  @if $value {
    @media (min-width: $value) {
      @content;
    }
  } @else {
    @warn "Unknown breakpoint: #{$breakpoint}";
  }
}

/// 最大宽度媒体查询
/// @param {String} $breakpoint - 断点名称
@mixin breakpoint-down($breakpoint) {
  $value: map-get($breakpoints, $breakpoint);
  @if $value {
    @media (max-width: #{$value - 1px}) {
      @content;
    }
  }
}

/// 断点范围媒体查询
/// @param {String} $min - 最小断点
/// @param {String} $max - 最大断点
@mixin breakpoint-between($min, $max) {
  $min-value: map-get($breakpoints, $min);
  $max-value: map-get($breakpoints, $max);
  @media (min-width: $min-value) and (max-width: #{$max-value - 1px}) {
    @content;
  }
}

// ============================================================================
// Flexbox 布局
// ============================================================================

/// Flex 容器
/// @param {String} $direction - 方向 (row, column)
/// @param {String} $justify - 主轴对齐
/// @param {String} $align - 交叉轴对齐
/// @param {String} $gap - 间距
@mixin flex($direction: row, $justify: flex-start, $align: stretch, $gap: null) {
  display: flex;
  flex-direction: $direction;
  justify-content: $justify;
  align-items: $align;
  @if $gap {
    gap: $gap;
  }
}

/// Flex 居中
@mixin flex-center {
  display: flex;
  justify-content: center;
  align-items: center;
}

/// Flex 两端对齐
@mixin flex-between {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

/// Flex 列布局
@mixin flex-column($gap: null) {
  display: flex;
  flex-direction: column;
  @if $gap {
    gap: $gap;
  }
}

// ============================================================================
// Grid 布局
// ============================================================================

/// Grid 容器
/// @param {Number} $columns - 列数
/// @param {String} $gap - 间距
@mixin grid($columns: 12, $gap: $space-4) {
  display: grid;
  grid-template-columns: repeat($columns, 1fr);
  gap: $gap;
}

/// 自动填充 Grid
/// @param {String} $min-width - 最小列宽
/// @param {String} $gap - 间距
@mixin grid-auto-fill($min-width: 280px, $gap: $space-4) {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax($min-width, 1fr));
  gap: $gap;
}

// ============================================================================
// 定位
// ============================================================================

/// 绝对定位填充
@mixin absolute-fill {
  position: absolute;
  inset: 0;
}

/// 固定定位填充
@mixin fixed-fill {
  position: fixed;
  inset: 0;
}

/// 绝对居中
@mixin absolute-center {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}

// ============================================================================
// 文本
// ============================================================================

/// 文本截断（单行）
@mixin text-truncate {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/// 多行文本截断
/// @param {Number} $lines - 行数
@mixin text-clamp($lines: 2) {
  display: -webkit-box;
  -webkit-line-clamp: $lines;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

/// 渐变文字
/// @param {String} $gradient - 渐变值
@mixin text-gradient($gradient: $gradient-brand) {
  background: $gradient;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

// ============================================================================
// 交互状态
// ============================================================================

/// 悬停效果
@mixin hover-lift {
  transition: transform $duration-normal $ease-out, box-shadow $duration-normal $ease-out;
  
  &:hover {
    transform: translateY(-2px);
    box-shadow: $shadow-lg;
  }
}

/// 点击效果
@mixin click-scale {
  transition: transform $duration-fast $ease-out;
  
  &:active {
    transform: scale(0.98);
  }
}

/// 焦点环
@mixin focus-ring($color: $accent-primary) {
  &:focus {
    outline: none;
    box-shadow: 0 0 0 2px rgba($color, 0.4);
  }
  
  &:focus:not(:focus-visible) {
    box-shadow: none;
  }
  
  &:focus-visible {
    outline: none;
    box-shadow: 0 0 0 2px rgba($color, 0.4);
  }
}

/// 禁用状态
@mixin disabled {
  opacity: 0.5;
  cursor: not-allowed;
  pointer-events: none;
}

// ============================================================================
// 视觉效果
// ============================================================================

/// 毛玻璃效果
/// @param {String} $blur - 模糊程度
/// @param {Color} $bg - 背景色
@mixin glass($blur: 12px, $bg: rgba($bg-secondary, 0.8)) {
  background: $bg;
  backdrop-filter: blur($blur);
  -webkit-backdrop-filter: blur($blur);
}

/// 卡片样式
@mixin card($padding: $space-6) {
  background: $bg-secondary;
  border: 1px solid $border-subtle;
  border-radius: $radius-xl;
  padding: $padding;
}

/// 发光效果
/// @param {Color} $color - 发光颜色
/// @param {String} $size - 发光大小
@mixin glow($color: $accent-primary, $size: 20px) {
  box-shadow: 0 0 $size rgba($color, 0.3);
}

/// 渐变边框
/// @param {String} $gradient - 渐变值
/// @param {String} $width - 边框宽度
@mixin gradient-border($gradient: $gradient-blue, $width: 1px) {
  position: relative;
  background: $bg-secondary;
  
  &::before {
    content: '';
    position: absolute;
    inset: 0;
    padding: $width;
    background: $gradient;
    border-radius: inherit;
    mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    mask-composite: exclude;
    -webkit-mask-composite: xor;
    pointer-events: none;
  }
}

// ============================================================================
// 滚动条
// ============================================================================

/// 自定义滚动条
/// @param {String} $width - 滚动条宽度
/// @param {Color} $thumb - 滑块颜色
/// @param {Color} $track - 轨道颜色
@mixin custom-scrollbar($width: 8px, $thumb: $border-muted, $track: $bg-secondary) {
  &::-webkit-scrollbar {
    width: $width;
    height: $width;
  }
  
  &::-webkit-scrollbar-track {
    background: $track;
    border-radius: $width / 2;
  }
  
  &::-webkit-scrollbar-thumb {
    background: $thumb;
    border-radius: $width / 2;
    
    &:hover {
      background: $border-focus;
    }
  }
}

/// 隐藏滚动条但保留滚动功能
@mixin hide-scrollbar {
  -ms-overflow-style: none;
  scrollbar-width: none;
  
  &::-webkit-scrollbar {
    display: none;
  }
}

// ============================================================================
// 动画
// ============================================================================

/// 淡入动画
@mixin fade-in($duration: $duration-normal) {
  animation: fadeIn $duration $ease-out;
  
  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }
}

/// 滑入动画
/// @param {String} $direction - 方向 (up, down, left, right)
/// @param {String} $distance - 距离
@mixin slide-in($direction: up, $distance: 20px, $duration: $duration-slow) {
  $translate: null;
  
  @if $direction == up {
    $translate: translateY($distance);
  } @else if $direction == down {
    $translate: translateY(-$distance);
  } @else if $direction == left {
    $translate: translateX($distance);
  } @else if $direction == right {
    $translate: translateX(-$distance);
  }
  
  animation: slideIn $duration $ease-out;
  
  @keyframes slideIn {
    from {
      opacity: 0;
      transform: $translate;
    }
    to {
      opacity: 1;
      transform: translate(0);
    }
  }
}

// ============================================================================
// 尺寸
// ============================================================================

/// 正方形
/// @param {String} $size - 尺寸
@mixin square($size) {
  width: $size;
  height: $size;
}

/// 圆形
/// @param {String} $size - 尺寸
@mixin circle($size) {
  @include square($size);
  border-radius: 50%;
}

/// 宽高比容器
/// @param {Number} $ratio - 宽高比 (如 16/9)
@mixin aspect-ratio($ratio: 1) {
  aspect-ratio: $ratio;
}
